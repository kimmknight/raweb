import{d as Z,u as j,a as G,r as v,o as Q,e as ee,i as ae,c as te,f as se,B as ne,j as V,C as u,k as m,l as a,m as t,T as oe,n as p,p as w,t as i,E as s,x as g,D as l,_ as b,I as O,F as D,v as re,a1 as I,a2 as K,P as ie,a3 as le,J as ue,K as ce,L as de,W as pe,X as ve,Y as he,Z as me}from"./shared-BCEOVn6X.js";const fe={class:"dialog-wrapper"},ye={class:"dialog"},we={style:{"font-size":"13px","font-weight":"400",opacity:"0.7",position:"absolute",top:"-12px",right:"6px"}},ge={class:"dialog-body"},be={style:{"white-space":"nowrap"}},_e={class:"input"},ke={class:"input"},$e={class:"access"},Se={class:"button-row"},Be=Z({__name:"Login",setup(S){const{appBase:_,iisBase:C,envMachineName:z,machineName:H,policies:B}=j(),{t:T}=G(),L=v(!1),k=v(null);Q(()=>{const o=new URLSearchParams(window.location.search).get("ReturnUrl");o?k.value=new URL(o,window.location.origin).href:k.value=_,window.history.replaceState({},"",window.location.pathname),B.anonymousAuthentication==="always"&&M(),ee().then(n=>{n==="SSL_ERROR"&&(L.value=!0)})});const N=v(!1);ae.then(()=>{N.value=!0});const x=te(()=>N.value);se(()=>{x.value&&setTimeout(()=>{ne()},300)});async function U(e,o,n){const c=await fetch(C+"api/auth/authenticate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:o})}).then(y=>y.json()).catch(()=>({success:!1})).finally(()=>{r.value=!1});if(h.value=c.domain+"\\"+(c.success?c.username:e.split("\\")[1]||e),!c.success){f.value=c.error?T(c.error):T("login.incorrectUsernameOrPassword"),r.value=!1;return}const d=n?decodeURIComponent(n):_;window.location.href=d}const f=v(null),r=v(!1),h=v(""),P=v(""),E=v(0);function J(){E.value+=1,P.value=""}async function X(e){e.preventDefault(),r.value=!0;const o=e.target.password,n=h.value,c=o.value;let d=n.includes("\\")?n.split("\\")[0]:"";const y=n.includes("\\")?n.split("\\")[1]:n;J(),d==="."&&(d=z,h.value=d+"\\"+y),d||(d=await fetch(C+"api/domain").then(R=>R.json()).then(R=>R.domain).catch(()=>""),h.value=d+"\\"+y),U(d+"\\"+y,c,k.value||void 0)}function A(){const e=document.querySelector("form");e&&!r.value&&(r.value=!0,e.dispatchEvent(new Event("submit",{bubbles:!1,cancelable:!0})))}function M(){U("RAWEB\\anonymous","",k.value||void 0)}const Y=B.passwordChangeEnabled===!1;return(e,o)=>(u(),V(D,null,[m(t(oe),{title:e.$t("login.title"),forceVisible:"",hideProfileMenu:"",withBorder:""},null,8,["title"]),a("div",fe,[a("div",ye,[L.value?(u(),p(t(O),{key:0,severity:"caution",title:e.$t("login.securityError503.title"),style:{"border-radius":"var(--wui-overlay-corner-radius) var(--wui-overlay-corner-radius) 0 0","flex-grow":"0","flex-shrink":"0"}},{default:i(()=>[a("span",we,s(e.$t("login.securityError503.code")),1),m(t(g),null,{default:i(()=>[l(s(e.$t("login.securityError503.message")),1)]),_:1}),o[2]||(o[2]=a("br",null,null,-1)),m(t(b),{variant:"hyperlink",href:"https://kimmknight.github.io/raweb/docs/security/error-5003/",class:"unindent",style:{"margin-bottom":"-6px"}},{default:i(()=>[l(s(e.$t("login.securityError503.action")),1)]),_:1})]),_:1},8,["title"])):w("",!0),a("div",ge,[a("form",{onSubmit:X},[a("div",null,[a("h1",null,s(e.$t("login.title")),1),a("p",null,[l(s(e.$t("login.captionContinue"))+" ",1),a("strong",null,s(e.$t("longAppName"))+s(" "),1),a("span",be,[l(s(e.$t("login.captionOn"))+" ",1),a("strong",null,s(t(H)),1)])]),f.value?(u(),p(t(O),{key:0,severity:"critical",style:{"margin-bottom":"16px"}},{default:i(()=>[f.value.includes("{password_change_button}")?(u(!0),V(D,{key:0},re(f.value.split("{password_change_button}"),(n,c)=>(u(),p(t(g),null,{default:i(()=>[l(s(n)+" ",1),!Y&&c<f.value.split("{password_change_button}").length-1?(u(),p(t(b),{key:0,href:`password?username=${h.value}`,variant:"hyperlink",class:"inline-button"},{default:i(()=>[l(s(e.$t("login.changePasswordButton")),1)]),_:1},8,["href"])):w("",!0)]),_:2},1024))),256)):(u(),p(t(g),{key:1},{default:i(()=>[l(s(f.value),1)]),_:1}))]),_:1})):w("",!0),a("label",_e,[m(t(g),null,{default:i(()=>[l(s(e.$t("username")),1)]),_:1}),(u(),p(t(K),{key:E.value,type:"text",id:"username",name:"username",value:h.value,"onUpdate:value":o[0]||(o[0]=n=>h.value=n),disabled:r.value,required:"",autocomplete:"username",onKeyup:I(A,["enter"])},null,8,["value","disabled"]))]),a("label",ke,[m(t(g),null,{default:i(()=>[l(s(e.$t("password")),1)]),_:1}),(u(),p(t(K),{key:E.value,type:"password",id:"password",name:"password",value:P.value,"onUpdate:value":o[1]||(o[1]=n=>P.value=n),disabled:r.value,autocomplete:"current-password",onKeyup:I(A,["enter"])},null,8,["value","disabled"]))]),a("p",$e,[l(s(e.$t("poweredBy"))+" ",1),o[3]||(o[3]=a("br",null,null,-1)),m(t(b),{href:"https://github.com/kimmknight/raweb",variant:"hyperlink",class:"unindent"},{default:i(()=>[l(s(e.$t("poweredByLearnMore")),1)]),_:1})])]),a("div",Se,[m(t(b),{type:"submit",variant:"accent",disabled:r.value},{default:i(()=>[r.value?(u(),p(t(ie),{key:0,size:16,style:{"--wui-accent-default":"var(--wui-text-on-accent-primary)"}})):w("",!0),a("span",{style:le(`visibility: ${r.value?"hidden":"visible"};`)},s(e.$t("login.continue")),5)]),_:1},8,["disabled"]),!r.value&&t(B).anonymousAuthentication==="allow"?(u(),p(t(b),{key:0,type:"button",variant:"hyperlink",disabled:r.value,onClick:M},{default:i(()=>[l(s(e.$t("login.continueAnonymous")),1)]),_:1},8,["disabled"])):w("",!0)])],32)])])])],64))}}),F=ue(Be,[["__scopeId","data-v-1cfb9d58"]]),W=ce({history:de(),routes:[{path:"/:pathMatch(.*)*",redirect:"/login"},{path:"/login",component:F}]}),q=pe();await j(q).fetchData();ve();const $=he(me(F));$.use(q);$.use(W);$.directive("swap",(S,_)=>{S.parentNode&&(S.outerHTML=_.value)});await W.isReady();$.mount("#app");
