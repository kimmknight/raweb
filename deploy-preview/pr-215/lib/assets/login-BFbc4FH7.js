import{d as X,u as z,a as Y,r as f,o as Z,e as ee,i as ae,c as te,f as se,D as ne,l as O,E as d,m,n as t,p as e,T as oe,q as v,s as g,x as l,H as s,z as _,G as u,_ as b,I as V,F as D,y as re,a6 as I,a7 as q,P as ie,a8 as le,L as ue,M as ce,O as de,$ as pe,a0 as ve,a1 as fe,a2 as he}from"./shared-CnmDa7U7.js";const me={class:"dialog-wrapper"},ye={class:"dialog"},we={style:{"font-size":"13px","font-weight":"400",opacity:"0.7",position:"absolute",top:"-12px",right:"6px"}},ge={class:"dialog-body"},_e={style:{"white-space":"nowrap"}},be={class:"input"},ke={class:"input"},xe={class:"access"},Se={class:"button-row"},Be=X({__name:"Login",setup(B){const{appBase:k,iisBase:C,envMachineName:$,machineName:j,policies:P}=z(),{t:a}=Y(),L=f(!1),x=f(null);Z(()=>{const o=new URLSearchParams(window.location.search).get("ReturnUrl");o?x.value=new URL(o,window.location.origin).href:x.value=new URL(k,window.location.origin).href,window.history.replaceState({},"",window.location.pathname),P.anonymousAuthentication==="always"&&M(),ee().then(n=>{n==="SSL_ERROR"&&(L.value=!0)})});const U=f(!1);ae.then(()=>{U.value=!0});const W=te(()=>U.value);se(()=>{W.value&&setTimeout(()=>{ne()},300)});async function N(c,o,n){const i=await fetch(C+"api/auth/authenticate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:c,password:o,returnUrl:n})}).then(w=>w.json()).catch(()=>({success:!1})).finally(()=>{r.value=!1});if(h.value=i.domain+"\\"+(i.success?i.username:c.split("\\")[1]||c),i.success&&i.mfa_redirect){r.value=!0,window.location.href=i.mfa_redirect;return}if(!i.success){y.value=i.error?a(i.error):a("login.incorrectUsernameOrPassword"),r.value=!1;return}const p=n?decodeURIComponent(n):k;window.location.href=p}const y=f(null),r=f(!1),h=f(""),R=f(""),E=f(0);function G(){E.value+=1,R.value=""}async function J(c){c.preventDefault(),r.value=!0;const o=c.target.password,n=h.value,i=o.value;let p=n.includes("\\")?n.split("\\")[0]:"";const w=n.includes("\\")?n.split("\\")[1]:n;G(),p==="."&&(p=$,h.value=p+"\\"+w),p||(p=await fetch(C+"api/domain").then(T=>T.json()).then(T=>T.domain).catch(()=>""),h.value=p+"\\"+w),N(p+"\\"+w,i,x.value||void 0)}function A(){const c=document.querySelector("form");c&&!r.value&&(r.value=!0,c.dispatchEvent(new Event("submit",{bubbles:!1,cancelable:!0})))}function M(){N("RAWEB\\anonymous","",x.value||void 0)}const Q=P.passwordChangeEnabled===!1;return(c,o)=>(d(),O(D,null,[m(e(oe),{title:e(a)("login.title"),forceVisible:"",hideProfileMenu:"",withBorder:""},null,8,["title"]),t("div",me,[t("div",ye,[L.value?(d(),v(e(V),{key:0,severity:"caution",title:e(a)("login.securityError503.title"),style:{"border-radius":"var(--wui-overlay-corner-radius) var(--wui-overlay-corner-radius) 0 0","flex-grow":"0","flex-shrink":"0"}},{default:l(()=>[t("span",we,s(e(a)("login.securityError503.code")),1),m(e(_),null,{default:l(()=>[u(s(e(a)("login.securityError503.message")),1)]),_:1}),o[2]||(o[2]=t("br",null,null,-1)),m(e(b),{variant:"hyperlink",href:"https://kimmknight.github.io/raweb/docs/security/error-5003/",class:"unindent",style:{"margin-bottom":"-6px"}},{default:l(()=>[u(s(e(a)("login.securityError503.action")),1)]),_:1})]),_:1},8,["title"])):g("",!0),t("div",ge,[t("form",{onSubmit:J},[t("div",null,[t("h1",null,s(e(a)("login.title")),1),t("p",null,[u(s(e(a)("login.captionContinue"))+" ",1),t("strong",null,s(e(a)("longAppName"))+s(" "),1),t("span",_e,[u(s(e(a)("login.captionOn"))+" ",1),t("strong",null,s(e(j)),1)])]),y.value?(d(),v(e(V),{key:0,severity:"critical",style:{"margin-bottom":"16px"}},{default:l(()=>[y.value.includes("{password_change_button}")?(d(!0),O(D,{key:0},re(y.value.split("{password_change_button}"),(n,i)=>(d(),v(e(_),null,{default:l(()=>[u(s(n)+" ",1),!Q&&i<y.value.split("{password_change_button}").length-1?(d(),v(e(b),{key:0,href:`password?username=${h.value}`,variant:"hyperlink",class:"inline-button"},{default:l(()=>[u(s(e(a)("login.changePasswordButton")),1)]),_:1},8,["href"])):g("",!0)]),_:2},1024))),256)):(d(),v(e(_),{key:1},{default:l(()=>[u(s(y.value),1)]),_:1}))]),_:1})):g("",!0),t("label",be,[m(e(_),null,{default:l(()=>[u(s(e(a)("username")),1)]),_:1}),(d(),v(e(q),{key:E.value,type:"text",id:"username",name:"username",value:h.value,"onUpdate:value":o[0]||(o[0]=n=>h.value=n),disabled:r.value,required:"",autocomplete:"username",onKeyup:I(A,["enter"])},null,8,["value","disabled"]))]),t("label",ke,[m(e(_),null,{default:l(()=>[u(s(e(a)("password")),1)]),_:1}),(d(),v(e(q),{key:E.value,type:"password",id:"password",name:"password",value:R.value,"onUpdate:value":o[1]||(o[1]=n=>R.value=n),disabled:r.value,autocomplete:"current-password",onKeyup:I(A,["enter"])},null,8,["value","disabled"]))]),t("p",xe,[u(s(e(a)("poweredBy"))+" ",1),o[3]||(o[3]=t("br",null,null,-1)),m(e(b),{href:"https://github.com/kimmknight/raweb",variant:"hyperlink",class:"unindent"},{default:l(()=>[u(s(e(a)("poweredByLearnMore")),1)]),_:1})])]),t("div",Se,[m(e(b),{type:"submit",variant:"accent",disabled:r.value},{default:l(()=>[r.value?(d(),v(e(ie),{key:0,size:16,style:{"--wui-accent-default":"var(--wui-text-on-accent-primary)"}})):g("",!0),t("span",{style:le(`visibility: ${r.value?"hidden":"visible"};`)},s(e(a)("login.continue")),5)]),_:1},8,["disabled"]),!r.value&&e(P).anonymousAuthentication==="allow"?(d(),v(e(b),{key:0,type:"button",variant:"hyperlink",disabled:r.value,onClick:M},{default:l(()=>[u(s(e(a)("login.continueAnonymous")),1)]),_:1},8,["disabled"])):g("",!0)])],32)])])])],64))}}),F=ue(Be,[["__scopeId","data-v-3e0c670a"]]),H=ce({history:de(),routes:[{path:"/:pathMatch(.*)*",redirect:"/login"},{path:"/login",component:F}]}),K=pe();await z(K).fetchData();ve();const S=fe(he(F));S.use(K);S.use(H);S.directive("swap",(B,k)=>{B.parentNode&&(B.outerHTML=k.value)});await H.isReady();S.mount("#app");
