import{d as A,u as L,a as J,r as d,o as W,e as Y,i as Z,c as G,f as Q,B as X,j as ee,C as P,k as o,l as n,m as t,T as ae,n as T,p as E,t as i,E as r,x as v,D as u,_,I as K,a4 as k,a5 as S,P as se,a6 as te,F as ne,J as oe,K as re,L as le,Y as ie,Z as ue,$ as de,a0 as ce}from"./shared-D_Ww1kbj.js";const pe={class:"dialog-wrapper"},ve={class:"dialog"},we={style:{"font-size":"13px","font-weight":"400",opacity:"0.7",position:"absolute",top:"-12px",right:"6px"}},me={class:"dialog-body"},fe={class:"input"},he={class:"input"},ye={class:"input"},be={class:"input"},ge={class:"access"},Pe={class:"button-row"},_e=A({__name:"ChangePassword",setup(B){const{appBase:y,envMachineName:x,iisBase:C}=L(),{t:F}=J(),U=d(!1),b=d(null);W(()=>{const e=new URLSearchParams(window.location.search),a=e.get("ReturnUrl");a?b.value=new URL(a,window.location.origin).href:b.value=y;const s=e.get("username");s&&(c.value=s),window.history.replaceState({},"",window.location.pathname),Y().then(f=>{f==="SSL_ERROR"&&(U.value=!0)})});const M=d(!1);Z.then(()=>{M.value=!0});const I=G(()=>M.value);Q(()=>{I.value&&setTimeout(()=>{X()},300)});const R=d(null),l=d(!1),c=d(""),w=d(""),p=d(""),m=d("");async function O(e){e.preventDefault(),l.value=!0;const a=e.target.username.value;let s=a.includes("\\")?a.split("\\")[0]:"";const f=a.includes("\\")?a.split("\\")[1]:a;s==="."&&(s=x,c.value=s+"\\"+f),s||(s=await fetch(C+"api/domain").then(h=>h.json()).then(h=>h.domain).catch(()=>""),c.value=s+"\\"+f),c.value=s+"\\"+f;const z=w.value,H=p.value;w.value="",p.value="",m.value="";const N=await fetch(C+"api/auth/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:c.value,oldPassword:z,newPassword:H})}).then(h=>h.json()).catch(()=>({success:!1}));if(!N.success){R.value=N.error||F("changePassword.genericFailureMessage"),l.value=!1;return}V()}function g(){const e=document.querySelector("form");e&&!l.value&&(l.value=!0,e.dispatchEvent(new Event("submit",{bubbles:!1,cancelable:!0})))}function V(){const e=b.value?decodeURIComponent(b.value):y;window.location.href=e}return(e,a)=>(P(),ee(ne,null,[o(t(ae),{title:e.$t("login.title"),forceVisible:"",hideProfileMenu:"",withBorder:""},null,8,["title"]),n("div",pe,[n("div",ve,[U.value?(P(),T(t(K),{key:0,severity:"caution",title:e.$t("login.securityError503.title"),style:{"border-radius":"var(--wui-overlay-corner-radius) var(--wui-overlay-corner-radius) 0 0","flex-grow":"0","flex-shrink":"0"}},{default:i(()=>[n("span",we,r(e.$t("login.securityError503.code")),1),o(t(v),null,{default:i(()=>[u(r(e.$t("login.securityError503.message")),1)]),_:1}),a[4]||(a[4]=n("br",null,null,-1)),o(t(_),{variant:"hyperlink",href:"https://kimmknight.github.io/raweb/docs/security/error-5003/",class:"unindent",style:{"margin-bottom":"-6px"}},{default:i(()=>[u(r(e.$t("login.securityError503.action")),1)]),_:1})]),_:1},8,["title"])):E("",!0),n("div",me,[n("form",{onSubmit:O},[n("div",null,[n("h1",null,r(e.$t("changePassword.title")),1),R.value?(P(),T(t(K),{key:0,severity:"critical",style:{"margin-bottom":"16px"}},{default:i(()=>[o(t(v),null,{default:i(()=>[u(r(R.value),1)]),_:1})]),_:1})):E("",!0),n("label",fe,[o(t(v),null,{default:i(()=>[u(r(e.$t("username")),1)]),_:1}),o(t(S),{type:"text",id:"username",name:"username",value:c.value,"onUpdate:value":a[0]||(a[0]=s=>c.value=s),disabled:l.value,required:"",autocomplete:"username",onKeyup:k(g,["enter"])},null,8,["value","disabled"])]),n("label",he,[o(t(v),null,{default:i(()=>[u(r(e.$t("changePassword.oldPassword")),1)]),_:1}),o(t(S),{type:"password",id:"oldPassword",name:"oldPassword",value:w.value,"onUpdate:value":a[1]||(a[1]=s=>w.value=s),disabled:l.value,autocomplete:"current-password",onKeyup:k(g,["enter"])},null,8,["value","disabled"])]),n("label",ye,[o(t(v),null,{default:i(()=>[u(r(e.$t("changePassword.newPassword")),1)]),_:1}),o(t(S),{type:"password",id:"newPassword",name:"newPassword",value:p.value,"onUpdate:value":a[2]||(a[2]=s=>p.value=s),disabled:l.value,required:"",autocomplete:"new-password",onKeyup:k(g,["enter"])},null,8,["value","disabled"])]),n("label",be,[o(t(v),null,{default:i(()=>[u(r(e.$t("changePassword.confirmPassword")),1)]),_:1}),o(t(S),{type:"password",id:"confirmPassword",name:"confirmPassword",value:m.value,"onUpdate:value":a[3]||(a[3]=s=>m.value=s),disabled:l.value,required:"",autocomplete:"new-password",onKeyup:k(g,["enter"])},null,8,["value","disabled"])]),n("p",ge,[u(r(e.$t("poweredBy"))+" ",1),a[5]||(a[5]=n("br",null,null,-1)),o(t(_),{href:"https://github.com/kimmknight/raweb",variant:"hyperlink",class:"unindent"},{default:i(()=>[u(r(e.$t("poweredByLearnMore")),1)]),_:1})])]),n("div",Pe,[o(t(_),{type:"button",variant:"standard",disabled:l.value,onClick:V},{default:i(()=>[u(r(e.$t("changePassword.cancel")),1)]),_:1},8,["disabled"]),o(t(_),{type:"submit",variant:"accent",disabled:l.value||!c.value||!p.value||!m.value||p.value!==m.value||w.value===p.value},{default:i(()=>[l.value?(P(),T(t(se),{key:0,size:16,style:{"--wui-accent-default":"var(--wui-text-on-accent-primary)"}})):E("",!0),n("span",{style:te(`visibility: ${l.value?"hidden":"visible"};`)},r(e.$t("changePassword.submit")),5)]),_:1},8,["disabled"])])],32)])])])],64))}}),q=oe(_e,[["__scopeId","data-v-c3719bd2"]]),D=re({history:le(),routes:[{path:"/:pathMatch(.*)*",redirect:"/password"},{path:"/password",component:q}]}),j=ie();await L(j).fetchData();ue();const $=de(ce(q));$.use(j);$.use(D);$.directive("swap",(B,y)=>{B.parentNode&&(B.outerHTML=y.value)});await D.isReady();$.mount("#app");
