import{d as me,c as S,u as V,a as ve,b as he,w as O,r as P,o as R,e as ye,i as ge,f as be,g as we,h as $,j as Q,k as ke,l as E,m as f,n as u,p as a,T as Se,q as b,s as M,t as w,N as Pe,v as Re,x as c,I as J,F as A,y as Ee,z as j,P as _e,A as Ce,B as H,C as L,D as De,E as o,G as m,H as _,_ as K,J as X,K as Te,L as Me,M as Ae,O as He,Q as Le,R as Ve,S as xe,U as We,V as Ie,W as Be,X as Ge,Y as Ne,Z as ee,$ as Ue,a0 as qe,a1 as Fe,a2 as ze,a3 as Oe,a4 as $e,a5 as Qe}from"./shared-DdW2KQq8.js";const Je={id:"appContent"},je={id:"page"},Ke={key:1},Xe={style:{display:"flex",gap:"8px","align-items":"center"}},Y="https://kimmknight.github.io/raweb/docs/security/error-5003/",Ye=me({__name:"App",setup(n){const v=HTMLDialogElement.prototype.requestClose!==void 0,i=S({get:()=>!1,set:()=>{}}),l=we(),d=V(),{t:C}=ve(),se=S(()=>d.capabilities.supportsCentralizedPublishing||!1),D={mergeTerminalServers:v===!1?i:H,hidePortsWhenPossible:L,supportsCentralizedPublishing:se},{data:k,loading:ne,error:re,refresh:T}=he(d.iisBase,D);let h=null;O(H,async(s,e)=>{if(s===h)return;const{error:t}=await T(D);t.value!==null?(h===null&&(h=e),H.value=h):h=null});let y=null;O(L,async(s,e)=>{if(s===y)return;const{error:t}=await T(D);t.value!==null?(y===null&&(y=e),L.value=y):y=null});const W=P(!1),I=P(!1);async function ie(s){if(s.data.type==="fetch-queue"){const e=s.data.backgroundFetchQueueLength>0;I.value=e}}R(()=>{ye(ie).then(s=>{s==="SSL_ERROR"&&(W.value=!0)})});const B=P(!1);ge.then(()=>{B.value=!0});const G=P(!1);R(()=>{G.value=!0});const oe=S(()=>G.value&&k.value&&!re.value&&B.value);be(()=>{oe.value&&De()}),R(()=>{const s=window.matchMedia("(prefers-reduced-motion: reduce)");function e(){s.matches}return s.addEventListener("change",e),s.matches,()=>{s.removeEventListener("change",e)}}),l.beforeResolve(async(s,e,t)=>{const r=window.matchMedia("(prefers-reduced-motion: reduce)").matches;if(!document.startViewTransition||r)return t();const g=document.querySelector(".root-splash-wrapper");if(g&&g.style.display!=="none")return;const q=document.querySelector("main"),F=q?q.querySelector("div"):null,de=s.name==="webGuacd"&&e.name!=="webGuacd",fe=s.name!=="webGuacd"&&e.name==="webGuacd",z=document.querySelector("#appContent > .nav-rail");await Promise.allSettled([$(F),de&&$(z)]),t(),await Promise.allSettled([Q(F),fe&&Q(z)])});const{updateDetails:N,populateUpdateDetails:le}=ke();R(()=>{le()});const ue=(()=>{const s=d.policies.signedInUserGlobalAlerts;if(!s)return[];try{const e=JSON.parse(s);return Array.isArray(e)?e.filter(t=>t&&typeof t=="object"&&typeof t.title=="string"||t.title===void 0&&typeof t.message=="string"||t.message===void 0&&(typeof t.linkText=="string"||t.linkText===void 0)&&(typeof t.linkHref=="string"||t.linkHref===void 0)&&(t.type==="information"||t.type==="attention"||t.type===void 0)):[]}catch{return[]}})();function U(s,e){const t=window.open(s,e,"width=1000,height=600,menubar=0,status=0");t?t.focus():alert("Please allow popups for this application")}const ce=S(()=>typeof window<"u"&&window.opener&&window.opener!==window);return(s,e)=>{const t=Ce("router-view");return o(),E(A,null,[f(a(Se),{forceVisible:!ce.value,loading:I.value||a(ne),update:a(N)},null,8,["forceVisible","loading","update"]),u("div",Je,[a(w)?M("",!0):(o(),b(a(Pe),{key:0,hidden:a(l).currentRoute.value.name==="webGuacd"},null,8,["hidden"])),u("main",{class:Re({simple:a(w)})},[W.value?(o(),b(a(J),{key:0,severity:"caution",title:a(C)("securityError503.title"),style:{"border-radius":"0"}},{default:c(()=>[m(_(a(C)("securityError503.message"))+" ",1),e[1]||(e[1]=u("br",null,null,-1)),f(a(K),{variant:"hyperlink",href:Y,style:{"margin-left":"-11px","margin-bottom":"-6px"},target:"_blank",onClick:e[0]||(e[0]=X(r=>U(Y,"help"),["prevent"]))},{default:c(()=>[m(_(a(C)("securityError503.action")),1)]),_:1})]),_:1},8,["title"])):M("",!0),(o(!0),E(A,null,Ee(a(ue),(r,g)=>(o(),b(a(J),{key:g,severity:r.type||"attention",title:r.title,class:"global-alert"},{default:c(()=>[m(_(r.message)+" ",1),r.linkText&&r.linkHref?(o(),E(A,{key:0},[e[2]||(e[2]=u("br",null,null,-1)),f(a(K),{variant:"hyperlink",href:r.linkHref,style:{"margin-left":"-11px","margin-bottom":"-6px"},target:"_blank",onClick:X(pe=>U(r.linkHref,r.title||`alert-link-${g}`),["prevent"])},{default:c(()=>[m(_(r.linkText),1)]),_:2},1032,["href","onClick"])],64)):M("",!0)]),_:2},1032,["severity","title"]))),128)),u("div",je,[a(k)?(o(),b(t,{key:0},{default:c(({Component:r})=>[(o(),b(Te(r),{data:a(k),update:a(N),workspace:a(k),"refresh-workspace":a(T)},null,8,["data","update","workspace","refresh-workspace"]))]),_:1})):(o(),E("div",Ke,[f(a(j),{variant:"title"},{default:c(()=>e[3]||(e[3]=[m("Loading")])),_:1}),e[5]||(e[5]=u("br",null,null,-1)),e[6]||(e[6]=u("br",null,null,-1)),u("div",Xe,[f(a(_e),{size:24}),f(a(j),{style:{"font-weight":"500"}},{default:c(()=>e[4]||(e[4]=[m("Please wait...")])),_:1})])]))])],2)])],64)}}}),Ze=Me(Ye,[["__scopeId","data-v-3cc78b07"]]),et=[{path:"/apps",component:Le},{path:"/devices",component:Ve},{path:"/favorites",component:xe},{path:"/policies",component:We},{path:"/settings",component:Ie},{path:"/simple",component:Be},{name:"webGuacd",path:"/client/:resourceId/:hostId",component:Ge},{path:"/",redirect(n){return Z()}},{path:"/:pathMatch(.*)*",component:Ne,beforeEnter:(n,v,i)=>{if(n.path.endsWith("/index.html")){const l=n.path.slice(0,-10)||"/",d=new URL(document.baseURI.replace("/index.html","/")).pathname;return l===d&&(window.location.href=d.slice(0,-1)+Z()),i(l)}if(n.path.endsWith(".html")){const l=n.path.slice(0,-5);return i(l)}i()}}],te=CSS.supports("position-area","center center");function Z(){return w.value?"/simple":ee.value&&te?"/favorites":"/apps"}const x=Ae({history:He(),routes:et});x.beforeEach((n,v,i)=>{if(!w.value&&n.path==="/simple")return i("/favorites");if(w.value&&["/apps","/devices","/favorites"].includes(n.path))return i("/simple");if((!ee.value||!te)&&n.path==="/favorites")return i("/apps");if(!V().authUser.isLocalAdministrator&&n.path==="/policies")return i("/favorites");i()});const ae=Ue();await V(ae).fetchData();qe();const p=Fe(ze(Ze));p.use(ae);p.use(x);p.use(Oe);p.use($e);p.use(Qe);p.directive("swap",(n,v)=>{n.parentNode&&(n.outerHTML=v.value)});await x.isReady();p.mount("#app");
