import{d as me,c as _,u as T,a as ve,b as he,w as O,r as C,o as P,e as ye,i as be,f as ge,g as we,h as $,j as Q,k as ke,l as D,m,n as p,p as a,T as Se,q as g,s as H,t as k,N as Ee,v as Re,x as d,I as J,F as L,y as _e,z as j,P as Ce,A as Pe,B as V,C as W,D as De,E as o,G as v,H as w,_ as K,J as X,K as Te,L as Me,M as Ae,O as He,Q as Le,R as Ve,S as We,U as Be,V as Ge,W as xe,X as Ie,Y as Ne,Z as ee,$ as Ue,a0 as qe,a1 as Fe,a2 as ze,a3 as Oe,a4 as $e,a5 as Qe}from"./shared-qlElnSqI.js";const Je={id:"appContent"},je={id:"page"},Ke={key:1},Xe={style:{display:"flex",gap:"8px","align-items":"center"}},Y="https://kimmknight.github.io/raweb/docs/security/error-5003/",Ye=me({__name:"App",setup(n){const l=HTMLDialogElement.prototype.requestClose!==void 0,r=_({get:()=>!1,set:()=>{}}),u=we(),c=T(),{t:E}=ve(),se=_(()=>c.capabilities.supportsCentralizedPublishing||!1),M={mergeTerminalServers:l===!1?r:V,hidePortsWhenPossible:W,supportsCentralizedPublishing:se},{data:R,loading:ne,error:ie,refresh:A}=he(c.iisBase,M);let h=null;O(V,async(s,e)=>{if(s===h)return;const{error:t}=await A(M);t.value!==null?(h===null&&(h=e),V.value=h):h=null});let y=null;O(W,async(s,e)=>{if(s===y)return;const{error:t}=await A(M);t.value!==null?(y===null&&(y=e),W.value=y):y=null});const B=C(!1),G=C(!1);async function re(s){if(s.data.type==="fetch-queue"){const e=s.data.backgroundFetchQueueLength>0;G.value=e}}P(()=>{ye(re).then(s=>{s==="SSL_ERROR"&&(B.value=!0)})});const x=C(!1);be.then(()=>{x.value=!0});const I=C(!1);P(()=>{I.value=!0});const oe=_(()=>I.value&&R.value&&!ie.value&&x.value);ge(()=>{oe.value&&De()}),P(()=>{const s=window.matchMedia("(prefers-reduced-motion: reduce)");function e(){s.matches}return s.addEventListener("change",e),s.matches,()=>{s.removeEventListener("change",e)}}),u.beforeResolve(async(s,e,t)=>{const i=window.matchMedia("(prefers-reduced-motion: reduce)").matches;if(!document.startViewTransition||i)return t();const b=document.querySelector(".root-splash-wrapper");if(b&&b.style.display!=="none")return t();const q=document.querySelector("main"),F=q?q.querySelector("div"):null,de=s.name==="webGuacd"&&e.name!=="webGuacd",fe=s.name!=="webGuacd"&&e.name==="webGuacd",z=document.querySelector("#appContent > .nav-rail");await Promise.allSettled([$(F),de&&$(z)]),t(),setTimeout(()=>{Q(F),fe&&Q(z)},0)});const{updateDetails:N,populateUpdateDetails:le}=ke();P(()=>{le()});const ue=(()=>{const s=c.policies.signedInUserGlobalAlerts;if(!s)return[];try{const e=JSON.parse(s);return Array.isArray(e)?e.filter(t=>t&&typeof t=="object"&&typeof t.title=="string"||t.title===void 0&&typeof t.message=="string"||t.message===void 0&&(typeof t.linkText=="string"||t.linkText===void 0)&&(typeof t.linkHref=="string"||t.linkHref===void 0)&&(t.type==="information"||t.type==="attention"||t.type===void 0)):[]}catch{return[]}})();function U(s,e){const t=window.open(s,e,"width=1000,height=600,menubar=0,status=0");t?t.focus():alert("Please allow popups for this application")}const ce=_(()=>typeof window<"u"&&window.opener&&window.opener!==window);return(s,e)=>{const t=Pe("router-view");return o(),D(L,null,[m(a(Se),{forceVisible:!ce.value,loading:G.value||a(ne),update:a(N)},null,8,["forceVisible","loading","update"]),p("div",Je,[a(k)?H("",!0):(o(),g(a(Ee),{key:0,hidden:a(u).currentRoute.value.name==="webGuacd"},null,8,["hidden"])),p("main",{class:Re({simple:a(k)})},[B.value?(o(),g(a(J),{key:0,severity:"caution",title:a(E)("securityError503.title"),style:{"border-radius":"0"}},{default:d(()=>[v(w(a(E)("securityError503.message"))+" ",1),e[1]||(e[1]=p("br",null,null,-1)),m(a(K),{variant:"hyperlink",href:Y,style:{"margin-left":"-11px","margin-bottom":"-6px"},target:"_blank",onClick:e[0]||(e[0]=X(i=>U(Y,"help"),["prevent"]))},{default:d(()=>[v(w(a(E)("securityError503.action")),1)]),_:1})]),_:1},8,["title"])):H("",!0),(o(!0),D(L,null,_e(a(ue),(i,b)=>(o(),g(a(J),{key:b,severity:i.type||"attention",title:i.title,class:"global-alert"},{default:d(()=>[v(w(i.message)+" ",1),i.linkText&&i.linkHref?(o(),D(L,{key:0},[e[2]||(e[2]=p("br",null,null,-1)),m(a(K),{variant:"hyperlink",href:i.linkHref,style:{"margin-left":"-11px","margin-bottom":"-6px"},target:"_blank",onClick:X(pe=>U(i.linkHref,i.title||`alert-link-${b}`),["prevent"])},{default:d(()=>[v(w(i.linkText),1)]),_:2},1032,["href","onClick"])],64)):H("",!0)]),_:2},1032,["severity","title"]))),128)),p("div",je,[a(R)?(o(),g(t,{key:0},{default:d(({Component:i})=>[(o(),g(Te(i),{data:a(R),update:a(N),workspace:a(R),"refresh-workspace":a(A)},null,8,["data","update","workspace","refresh-workspace"]))]),_:1})):(o(),D("div",Ke,[m(a(j),{variant:"title"},{default:d(()=>e[3]||(e[3]=[v("Loading")])),_:1}),e[4]||(e[4]=p("br",null,null,-1)),e[5]||(e[5]=p("br",null,null,-1)),p("div",Xe,[m(a(Ce),{size:24}),m(a(j),{style:{"font-weight":"500"}},{default:d(()=>[v(w(a(E)("pleaseWait")),1)]),_:1})])]))])],2)])],64)}}}),Ze=Me(Ye,[["__scopeId","data-v-8a01b15c"]]),et=[{path:"/apps",component:Le},{path:"/devices",component:Ve},{path:"/favorites",component:We},{path:"/policies",component:Be},{path:"/settings",component:Ge},{path:"/simple",component:xe},{name:"webGuacd",path:"/client/:resourceId/:hostId",component:Ie},{path:"/",redirect(n){return Z()}},{path:"/:pathMatch(.*)*",component:Ne,beforeEnter:(n,l,r)=>{if(n.path.endsWith("/index.html")){const u=n.path.slice(0,-10)||"/",c=new URL(document.baseURI.replace("/index.html","/")).pathname;return u===c&&(window.location.href=c.slice(0,-1)+Z()),r(u)}if(n.path.endsWith(".html")){const u=n.path.slice(0,-5);return r(u)}r()}}],te=CSS.supports("position-area","center center");function Z(){return k.value?"/simple":ee.value&&te?"/favorites":"/apps"}const S=Ae({history:He(),routes:et});S.afterEach((n,l)=>{delete l.meta.isTitlebarBackButton,delete l.meta.isDeviceCancelButton});S.beforeEach((n,l,r)=>{if(!k.value&&n.path==="/simple")return r("/favorites");if(k.value&&["/apps","/devices","/favorites"].includes(n.path))return r("/simple");if((!ee.value||!te)&&n.path==="/favorites")return r("/apps");if(!T().authUser.isLocalAdministrator&&n.path==="/policies")return r("/favorites");const{capabilities:c}=T();!c.supportsGuacdWebClient&&n.name==="webGuacd"&&S.replace("/404"),r()});const ae=Ue();await T(ae).fetchData();typeof window<"u"&&qe();const f=Fe(ze(Ze));f.use(ae);f.use(S);f.use(Oe);f.use($e);f.use(Qe);f.directive("swap",(n,l)=>{n.parentNode&&(n.outerHTML=l.value)});await S.isReady();f.mount("#app");
