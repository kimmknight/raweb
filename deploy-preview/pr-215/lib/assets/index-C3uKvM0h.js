import{d as me,c as R,u as B,a as ve,b as he,w as O,r as _,o as P,e as ye,i as ge,f as be,g as we,h as $,j as Q,k as ke,l as C,m,n as c,p as a,T as Se,q as b,s as A,t as k,N as Ee,v as Re,x as p,I as J,F as H,y as _e,z as j,P as Pe,A as Ce,B as L,C as V,D as De,E as o,G as v,H as w,_ as K,J as X,K as Te,L as Me,M as Ae,O as He,Q as Le,R as Ve,S as Be,U as We,V as xe,W as Ie,X as Ge,Y as Ne,Z as ee,$ as Ue,a0 as qe,a1 as Fe,a2 as ze,a3 as Oe,a4 as $e,a5 as Qe}from"./shared-DEFpb1Q4.js";const Je={id:"appContent"},je={id:"page"},Ke={key:1},Xe={style:{display:"flex",gap:"8px","align-items":"center"}},Y="https://kimmknight.github.io/raweb/docs/security/error-5003/",Ye=me({__name:"App",setup(n){const l=HTMLDialogElement.prototype.requestClose!==void 0,r=R({get:()=>!1,set:()=>{}}),u=we(),f=B(),{t:S}=ve(),se=R(()=>f.capabilities.supportsCentralizedPublishing||!1),T={mergeTerminalServers:l===!1?r:L,hidePortsWhenPossible:V,supportsCentralizedPublishing:se},{data:E,loading:ne,error:ie,refresh:M}=he(f.iisBase,T);let h=null;O(L,async(s,e)=>{if(s===h)return;const{error:t}=await M(T);t.value!==null?(h===null&&(h=e),L.value=h):h=null});let y=null;O(V,async(s,e)=>{if(s===y)return;const{error:t}=await M(T);t.value!==null?(y===null&&(y=e),V.value=y):y=null});const W=_(!1),x=_(!1);async function re(s){if(s.data.type==="fetch-queue"){const e=s.data.backgroundFetchQueueLength>0;x.value=e}}P(()=>{ye(re).then(s=>{s==="SSL_ERROR"&&(W.value=!0)})});const I=_(!1);ge.then(()=>{I.value=!0});const G=_(!1);P(()=>{G.value=!0});const oe=R(()=>G.value&&E.value&&!ie.value&&I.value);be(()=>{oe.value&&De()}),P(()=>{const s=window.matchMedia("(prefers-reduced-motion: reduce)");function e(){s.matches}return s.addEventListener("change",e),s.matches,()=>{s.removeEventListener("change",e)}}),u.beforeResolve(async(s,e,t)=>{const i=window.matchMedia("(prefers-reduced-motion: reduce)").matches;if(!document.startViewTransition||i)return t();const g=document.querySelector(".root-splash-wrapper");if(g&&g.style.display!=="none")return t();const q=document.querySelector("main"),F=q?q.querySelector("div"):null,de=s.name==="webGuacd"&&e.name!=="webGuacd",fe=s.name!=="webGuacd"&&e.name==="webGuacd",z=document.querySelector("#appContent > .nav-rail");await Promise.allSettled([$(F),de&&$(z)]),t(),setTimeout(()=>{Q(F),fe&&Q(z)},0)});const{updateDetails:N,populateUpdateDetails:le}=ke();P(()=>{le()});const ue=(()=>{const s=f.policies.signedInUserGlobalAlerts;if(!s)return[];try{const e=JSON.parse(s);return Array.isArray(e)?e.filter(t=>t&&typeof t=="object"&&typeof t.title=="string"||t.title===void 0&&typeof t.message=="string"||t.message===void 0&&(typeof t.linkText=="string"||t.linkText===void 0)&&(typeof t.linkHref=="string"||t.linkHref===void 0)&&(t.type==="information"||t.type==="attention"||t.type===void 0)):[]}catch{return[]}})();function U(s,e){const t=window.open(s,e,"width=1000,height=600,menubar=0,status=0");t?t.focus():alert("Please allow popups for this application")}const ce=R(()=>typeof window<"u"&&window.opener&&window.opener!==window);return(s,e)=>{const t=Ce("router-view");return o(),C(H,null,[m(a(Se),{forceVisible:!ce.value,loading:x.value||a(ne),update:a(N)},null,8,["forceVisible","loading","update"]),c("div",Je,[a(k)?A("",!0):(o(),b(a(Ee),{key:0,hidden:a(u).currentRoute.value.name==="webGuacd"},null,8,["hidden"])),c("main",{class:Re({simple:a(k)})},[W.value?(o(),b(a(J),{key:0,severity:"caution",title:a(S)("securityError503.title"),style:{"border-radius":"0"}},{default:p(()=>[v(w(a(S)("securityError503.message"))+" ",1),e[1]||(e[1]=c("br",null,null,-1)),m(a(K),{variant:"hyperlink",href:Y,style:{"margin-left":"-11px","margin-bottom":"-6px"},target:"_blank",onClick:e[0]||(e[0]=X(i=>U(Y,"help"),["prevent"]))},{default:p(()=>[v(w(a(S)("securityError503.action")),1)]),_:1})]),_:1},8,["title"])):A("",!0),(o(!0),C(H,null,_e(a(ue),(i,g)=>(o(),b(a(J),{key:g,severity:i.type||"attention",title:i.title,class:"global-alert"},{default:p(()=>[v(w(i.message)+" ",1),i.linkText&&i.linkHref?(o(),C(H,{key:0},[e[2]||(e[2]=c("br",null,null,-1)),m(a(K),{variant:"hyperlink",href:i.linkHref,style:{"margin-left":"-11px","margin-bottom":"-6px"},target:"_blank",onClick:X(pe=>U(i.linkHref,i.title||`alert-link-${g}`),["prevent"])},{default:p(()=>[v(w(i.linkText),1)]),_:2},1032,["href","onClick"])],64)):A("",!0)]),_:2},1032,["severity","title"]))),128)),c("div",je,[a(E)?(o(),b(t,{key:0},{default:p(({Component:i})=>[(o(),b(Te(i),{data:a(E),update:a(N),workspace:a(E),"refresh-workspace":a(M)},null,8,["data","update","workspace","refresh-workspace"]))]),_:1})):(o(),C("div",Ke,[m(a(j),{variant:"title"},{default:p(()=>e[3]||(e[3]=[v("Loading")])),_:1}),e[4]||(e[4]=c("br",null,null,-1)),e[5]||(e[5]=c("br",null,null,-1)),c("div",Xe,[m(a(Pe),{size:24}),m(a(j),{style:{"font-weight":"500"}},{default:p(()=>[v(w(a(S)("pleaseWait")),1)]),_:1})])]))])],2)])],64)}}}),Ze=Me(Ye,[["__scopeId","data-v-8a01b15c"]]),et=[{path:"/apps",component:Le},{path:"/devices",component:Ve},{path:"/favorites",component:Be},{path:"/policies",component:We},{path:"/settings",component:xe},{path:"/simple",component:Ie},{name:"webGuacd",path:"/client/:resourceId/:hostId",component:Ge},{path:"/",redirect(n){return Z()}},{path:"/:pathMatch(.*)*",component:Ne,beforeEnter:(n,l,r)=>{if(n.path.endsWith("/index.html")){const u=n.path.slice(0,-10)||"/",f=new URL(document.baseURI.replace("/index.html","/")).pathname;return u===f&&(window.location.href=f.slice(0,-1)+Z()),r(u)}if(n.path.endsWith(".html")){const u=n.path.slice(0,-5);return r(u)}r()}}],te=CSS.supports("position-area","center center");function Z(){return k.value?"/simple":ee.value&&te?"/favorites":"/apps"}const D=Ae({history:He(),routes:et});D.afterEach((n,l)=>{delete l.meta.isTitlebarBackButton,delete l.meta.isDeviceCancelButton});D.beforeEach((n,l,r)=>{if(!k.value&&n.path==="/simple")return r("/favorites");if(k.value&&["/apps","/devices","/favorites"].includes(n.path))return r("/simple");if((!ee.value||!te)&&n.path==="/favorites")return r("/apps");if(!B().authUser.isLocalAdministrator&&n.path==="/policies")return r("/favorites");r()});const ae=Ue();await B(ae).fetchData();typeof window<"u"&&qe();const d=Fe(ze(Ze));d.use(ae);d.use(D);d.use(Oe);d.use($e);d.use(Qe);d.directive("swap",(n,l)=>{n.parentNode&&(n.outerHTML=l.value)});await D.isReady();d.mount("#app");
