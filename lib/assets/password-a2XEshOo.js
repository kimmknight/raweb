import{d as W,u as L,a as A,r as d,o as J,e as X,i as Y,c as G,f as Q,B as Z,j as ee,C as P,k as o,l as n,m as t,T as ae,n as E,p as T,t as i,E as r,x as v,D as u,_,I as K,a0 as k,a1 as S,P as se,a2 as te,F as ne,J as oe,K as re,L as le,W as ie,X as ue,Y as de}from"./shared-CmGlwVpC.js";const ce={class:"dialog-wrapper"},pe={class:"dialog"},ve={style:{"font-size":"13px","font-weight":"400",opacity:"0.7",position:"absolute",top:"-12px",right:"6px"}},we={class:"dialog-body"},me={class:"input"},fe={class:"input"},he={class:"input"},ye={class:"input"},be={class:"access"},ge={class:"button-row"},Pe=W({__name:"ChangePassword",setup(B){const{appBase:y,envMachineName:x,iisBase:C}=L(),{t:I}=A(),U=d(!1),b=d(null);J(()=>{const e=new URLSearchParams(window.location.search),a=e.get("ReturnUrl");a?b.value=new URL(a,window.location.origin).href:b.value=y;const s=e.get("username");s&&(c.value=s),window.history.replaceState({},"",window.location.pathname),X().then(f=>{f==="SSL_ERROR"&&(U.value=!0)})});const M=d(!1);Y.then(()=>{M.value=!0});const O=G(()=>M.value);Q(()=>{O.value&&setTimeout(()=>{Z()},300)});const R=d(null),l=d(!1),c=d(""),w=d(""),p=d(""),m=d("");async function z(e){e.preventDefault(),l.value=!0;const a=e.target.username.value;let s=a.includes("\\")?a.split("\\")[0]:"";const f=a.includes("\\")?a.split("\\")[1]:a;s==="."&&(s=x,c.value=s+"\\"+f),s||(s=await fetch(C+"api/domain").then(h=>h.json()).then(h=>h.domain).catch(()=>""),c.value=s+"\\"+f),c.value=s+"\\"+f;const F=w.value,H=p.value;w.value="",p.value="",m.value="";const N=await fetch(C+"api/auth/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:c.value,oldPassword:F,newPassword:H})}).then(h=>h.json()).catch(()=>({success:!1}));if(!N.success){R.value=N.error||I("changePassword.genericFailureMessage"),l.value=!1;return}V()}function g(){const e=document.querySelector("form");e&&!l.value&&(l.value=!0,e.dispatchEvent(new Event("submit",{bubbles:!1,cancelable:!0})))}function V(){const e=b.value?decodeURIComponent(b.value):y;window.location.href=e}return(e,a)=>(P(),ee(ne,null,[o(t(ae),{title:e.$t("login.title"),forceVisible:"",hideProfileMenu:"",withBorder:""},null,8,["title"]),n("div",ce,[n("div",pe,[U.value?(P(),E(t(K),{key:0,severity:"caution",title:e.$t("login.securityError503.title"),style:{"border-radius":"var(--wui-overlay-corner-radius) var(--wui-overlay-corner-radius) 0 0","flex-grow":"0","flex-shrink":"0"}},{default:i(()=>[n("span",ve,r(e.$t("login.securityError503.code")),1),o(t(v),null,{default:i(()=>[u(r(e.$t("login.securityError503.message")),1)]),_:1}),a[4]||(a[4]=n("br",null,null,-1)),o(t(_),{variant:"hyperlink",href:"https://kimmknight.github.io/raweb/docs/security/error-5003/",class:"unindent",style:{"margin-bottom":"-6px"}},{default:i(()=>[u(r(e.$t("login.securityError503.action")),1)]),_:1})]),_:1},8,["title"])):T("",!0),n("div",we,[n("form",{onSubmit:z},[n("div",null,[n("h1",null,r(e.$t("changePassword.title")),1),R.value?(P(),E(t(K),{key:0,severity:"critical",style:{"margin-bottom":"16px"}},{default:i(()=>[o(t(v),null,{default:i(()=>[u(r(R.value),1)]),_:1})]),_:1})):T("",!0),n("label",me,[o(t(v),null,{default:i(()=>[u(r(e.$t("username")),1)]),_:1}),o(t(S),{type:"text",id:"username",name:"username",value:c.value,"onUpdate:value":a[0]||(a[0]=s=>c.value=s),disabled:l.value,required:"",autocomplete:"username",onKeyup:k(g,["enter"])},null,8,["value","disabled"])]),n("label",fe,[o(t(v),null,{default:i(()=>[u(r(e.$t("changePassword.oldPassword")),1)]),_:1}),o(t(S),{type:"password",id:"oldPassword",name:"oldPassword",value:w.value,"onUpdate:value":a[1]||(a[1]=s=>w.value=s),disabled:l.value,autocomplete:"current-password",onKeyup:k(g,["enter"])},null,8,["value","disabled"])]),n("label",he,[o(t(v),null,{default:i(()=>[u(r(e.$t("changePassword.newPassword")),1)]),_:1}),o(t(S),{type:"password",id:"newPassword",name:"newPassword",value:p.value,"onUpdate:value":a[2]||(a[2]=s=>p.value=s),disabled:l.value,required:"",autocomplete:"new-password",onKeyup:k(g,["enter"])},null,8,["value","disabled"])]),n("label",ye,[o(t(v),null,{default:i(()=>[u(r(e.$t("changePassword.confirmPassword")),1)]),_:1}),o(t(S),{type:"password",id:"confirmPassword",name:"confirmPassword",value:m.value,"onUpdate:value":a[3]||(a[3]=s=>m.value=s),disabled:l.value,required:"",autocomplete:"new-password",onKeyup:k(g,["enter"])},null,8,["value","disabled"])]),n("p",be,[u(r(e.$t("poweredBy"))+" ",1),a[5]||(a[5]=n("br",null,null,-1)),o(t(_),{href:"https://github.com/kimmknight/raweb",variant:"hyperlink",class:"unindent"},{default:i(()=>[u(r(e.$t("poweredByLearnMore")),1)]),_:1})])]),n("div",ge,[o(t(_),{type:"button",variant:"standard",disabled:l.value,onClick:V},{default:i(()=>[u(r(e.$t("changePassword.cancel")),1)]),_:1},8,["disabled"]),o(t(_),{type:"submit",variant:"accent",disabled:l.value||!c.value||!p.value||!m.value||p.value!==m.value||w.value===p.value},{default:i(()=>[l.value?(P(),E(t(se),{key:0,size:16,style:{"--wui-accent-default":"var(--wui-text-on-accent-primary)"}})):T("",!0),n("span",{style:te(`visibility: ${l.value?"hidden":"visible"};`)},r(e.$t("changePassword.submit")),5)]),_:1},8,["disabled"])])],32)])])])],64))}}),D=oe(Pe,[["__scopeId","data-v-c3719bd2"]]),j=re({history:le(),routes:[{path:"/:pathMatch(.*)*",redirect:"/password"},{path:"/password",component:D}]}),q=ie();await L(q).fetchData();const $=ue(de(D));$.use(q);$.use(j);$.directive("swap",(B,y)=>{B.parentNode&&(B.outerHTML=y.value)});await j.isReady();$.mount("#app");
