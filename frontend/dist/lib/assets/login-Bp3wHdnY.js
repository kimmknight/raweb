import{d as Z,u as W,Y as G,r as v,o as Q,b as ee,i as ae,c as te,e as se,A as ne,h as M,B as u,j as m,k as a,l as t,T as oe,m as p,n as w,q as i,D as s,v as g,C as l,E as b,I as O,F as D,t as re,Z as I,$ as K,P as ie,a0 as le,_ as ue,J as ce,K as de,V as pe,W as ve,X as he}from"./shared-C1qu_bLV.js";const me={class:"dialog-wrapper"},fe={class:"dialog"},ye={style:{"font-size":"13px","font-weight":"400",opacity:"0.7",position:"absolute",top:"-12px",right:"6px"}},we={class:"dialog-body"},ge={style:{"white-space":"nowrap"}},be={class:"input"},_e={class:"input"},ke={class:"access"},$e={class:"button-row"},Se=Z({__name:"Login",setup(S){const{appBase:_,iisBase:C,envMachineName:z,machineName:H,policies:B}=W(),{t:T}=G(),A=v(!1),k=v(null);Q(()=>{const o=new URLSearchParams(window.location.search).get("ReturnUrl");o?k.value=new URL(o,window.location.origin).href:k.value=_,window.history.replaceState({},"",window.location.pathname),B.anonymousAuthentication==="always"&&V(),ee().then(n=>{n==="SSL_ERROR"&&(A.value=!0)})});const N=v(!1);ae.then(()=>{N.value=!0});const x=te(()=>N.value);se(()=>{x.value&&setTimeout(()=>{ne()},300)});async function U(e,o,n){const c=await fetch(C+"api/auth/authenticate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:o})}).then(y=>y.json()).catch(()=>({success:!1})).finally(()=>{r.value=!1});if(h.value=c.domain+"\\"+(c.success?c.username:e.split("\\")[1]||e),!c.success){f.value=c.error?T(c.error):T("login.incorrectUsernameOrPassword"),r.value=!1;return}const d=n?decodeURIComponent(n):_;window.location.href=d}const f=v(null),r=v(!1),h=v(""),P=v(""),R=v(0);function J(){R.value+=1,P.value=""}async function X(e){e.preventDefault(),r.value=!0;const o=e.target.password,n=h.value,c=o.value;let d=n.includes("\\")?n.split("\\")[0]:"";const y=n.includes("\\")?n.split("\\")[1]:n;J(),d==="."&&(d=z,h.value=d+"\\"+y),d||(d=await fetch(C+"api/domain").then(E=>E.json()).then(E=>E.domain).catch(()=>""),h.value=d+"\\"+y),U(d+"\\"+y,c,k.value||void 0)}function L(){const e=document.querySelector("form");e&&!r.value&&(r.value=!0,e.dispatchEvent(new Event("submit",{bubbles:!1,cancelable:!0})))}function V(){U("RAWEB\\anonymous","",k.value||void 0)}const Y=B.passwordChangeEnabled===!1;return(e,o)=>(u(),M(D,null,[m(t(oe),{title:e.$t("login.title"),forceVisible:"",hideProfileMenu:"",withBorder:""},null,8,["title"]),a("div",me,[a("div",fe,[A.value?(u(),p(t(O),{key:0,severity:"caution",title:e.$t("login.securityError503.title"),style:{"border-radius":"var(--wui-overlay-corner-radius) var(--wui-overlay-corner-radius) 0 0","flex-grow":"0","flex-shrink":"0"}},{default:i(()=>[a("span",ye,s(e.$t("login.securityError503.code")),1),m(t(g),null,{default:i(()=>[l(s(e.$t("login.securityError503.message")),1)]),_:1}),o[2]||(o[2]=a("br",null,null,-1)),m(t(b),{variant:"hyperlink",href:"https://github.com/kimmknight/raweb/wiki/Trusting-the-RAWeb-server-(Fix-security-error-5003)",class:"unindent",style:{"margin-bottom":"-6px"}},{default:i(()=>[l(s(e.$t("login.securityError503.action")),1)]),_:1})]),_:1},8,["title"])):w("",!0),a("div",we,[a("form",{onSubmit:X},[a("div",null,[a("h1",null,s(e.$t("login.title")),1),a("p",null,[l(s(e.$t("login.captionContinue"))+" ",1),a("strong",null,s(e.$t("longAppName"))+s(" "),1),a("span",ge,[l(s(e.$t("login.captionOn"))+" ",1),a("strong",null,s(t(H)),1)])]),f.value?(u(),p(t(O),{key:0,severity:"critical",style:{"margin-bottom":"16px"}},{default:i(()=>[f.value.includes("{password_change_button}")?(u(!0),M(D,{key:0},re(f.value.split("{password_change_button}"),(n,c)=>(u(),p(t(g),null,{default:i(()=>[l(s(n)+" ",1),!Y&&c<f.value.split("{password_change_button}").length-1?(u(),p(t(b),{key:0,href:`password?username=${h.value}`,variant:"hyperlink",class:"inline-button"},{default:i(()=>[l(s(e.$t("login.changePasswordButton")),1)]),_:1},8,["href"])):w("",!0)]),_:2},1024))),256)):(u(),p(t(g),{key:1},{default:i(()=>[l(s(f.value),1)]),_:1}))]),_:1})):w("",!0),a("label",be,[m(t(g),null,{default:i(()=>[l(s(e.$t("username")),1)]),_:1}),(u(),p(t(K),{key:R.value,type:"text",id:"username",name:"username",value:h.value,"onUpdate:value":o[0]||(o[0]=n=>h.value=n),disabled:r.value,required:"",autocomplete:"username",onKeyup:I(L,["enter"])},null,8,["value","disabled"]))]),a("label",_e,[m(t(g),null,{default:i(()=>[l(s(e.$t("password")),1)]),_:1}),(u(),p(t(K),{key:R.value,type:"password",id:"password",name:"password",value:P.value,"onUpdate:value":o[1]||(o[1]=n=>P.value=n),disabled:r.value,autocomplete:"current-password",onKeyup:I(L,["enter"])},null,8,["value","disabled"]))]),a("p",ke,[l(s(e.$t("poweredBy"))+" ",1),o[3]||(o[3]=a("br",null,null,-1)),m(t(b),{href:"https://github.com/kimmknight/raweb",variant:"hyperlink",class:"unindent"},{default:i(()=>[l(s(e.$t("poweredByLearnMore")),1)]),_:1})])]),a("div",$e,[m(t(b),{type:"submit",variant:"accent",disabled:r.value},{default:i(()=>[r.value?(u(),p(t(ie),{key:0,size:16,style:{"--wui-accent-default":"var(--wui-text-on-accent-primary)"}})):w("",!0),a("span",{style:le(`visibility: ${r.value?"hidden":"visible"};`)},s(e.$t("login.continue")),5)]),_:1},8,["disabled"]),!r.value&&t(B).anonymousAuthentication==="allow"?(u(),p(t(b),{key:0,type:"button",variant:"hyperlink",disabled:r.value,onClick:V},{default:i(()=>[l(s(e.$t("login.continueAnonymous")),1)]),_:1},8,["disabled"])):w("",!0)])],32)])])])],64))}}),j=ue(Se,[["__scopeId","data-v-1a391c79"]]),F=ce({history:de(),routes:[{path:"/:pathMatch(.*)*",redirect:"/login"},{path:"/login",component:j}]}),q=pe();await W(q).fetchData();const $=ve(he(j));$.use(q);$.use(F);$.directive("swap",(S,_)=>{S.parentNode&&(S.outerHTML=_.value)});await F.isReady();$.mount("#app");
